{% extends "form_div_layout.html.twig" %}

{%- block form_start -%}
    {{- parent() -}}
{%- endblock form_start -%}

{%- block form -%}
    {{- parent() -}}
{%- endblock form -%}


{%- block collection_widget -%}
    {% if prototype is defined %}
        {%- set attr = attr|merge({'data-prototype': form_row(prototype) }) -%}
    {% endif %}

    {% if dataOptions is defined %}
        {%- set attr = attr|merge({'data-options': dataOptions }) -%}
    {% endif %}

    {{- block('form_widget') -}}
{%- endblock collection_widget -%}


{%- block collection_row -%}
    <div class="collection row">
        <div class="collection-label span-medium-8 span-large-6 span-xlarge-10 form-left">
            {{- form_label(form) -}}
        </div>
        <div
            class="collection-widget span-none-padding-medium-16 span-none-padding-large-18 span-none-padding-xlarge-14 form-right form-right">
            {{- form_widget(form) -}}
        </div>
    </div>
{%- endblock collection_row -%}


{%- block choice_widget_collapsed -%}
    {%- if required and placeholder is none and not placeholder_in_choices and not multiple -%}
        {% set required = false %}
    {%- endif -%}

    <div class="input-postfix-icon form-select">
        <div class="select-style form-control">
            <select {{ block('widget_attributes') }}{% if multiple %} multiple="multiple"{% endif %}>
                {%- if placeholder is not none -%}
                    <option
                        value=""{% if required and value is empty %} selected="selected"{% endif %}>{{ placeholder|trans({}, translation_domain) }}</option>
                {%- endif -%}
                {%- if preferred_choices|length > 0 -%}
                    {% set options = preferred_choices %}
                    {{- block('choice_widget_options') -}}
                    {%- if choices|length > 0 and separator is not none -%}
                        <option disabled="disabled">{{ separator }}</option>
                    {%- endif -%}
                {%- endif -%}
                {%- set options = choices -%}
                {{- block('choice_widget_options') -}}
            </select>
        </div>
    </div>
{%- endblock choice_widget_collapsed -%}


{%- block button_row -%}
    {{- form_widget(form) -}}
{%- endblock button_row -%}

{%- block button_widget -%}
    {%- if label is empty -%}
        {%- if label_format is not empty -%}
            {% set label = label_format|replace({
            '%name%': name,
            '%id%': id,
            }) %}
        {%- else -%}
            {% set label = name|humanize %}
        {%- endif -%}
    {%- endif -%}
    <input type="{{ type|default('button') }}" {{ block('button_attributes') }}
           value="{{ label|trans({}, translation_domain) }}"/>
{%- endblock button_widget -%}


{%- block form_row -%}

    {% set choice = false %}


    {% for prefix in form.vars.block_prefixes %}
        {% if prefix == 'choice' %}
            {% set choice = true %}
        {% endif %}
    {% endfor %}

    <div class="row" id="row_{{ id }}">
        {% set class = "" %}
        {% if form.vars.attr.class is defined %}
            {% set class = form.vars.attr.class %}
        {% endif %}
        <div class="span-medium-8 span-large-6 span-xlarge-10 form-left {{ class }}">
            {{- form_label(form) -}}
        </div>
        {# @todo remove checkbox-inlie #}
        <div
            class="span-none-padding-medium-16 span-none-padding-large-18 span-none-padding-xlarge-14 form-right checkbox-inline">
            {{- form_widget(form) -}}
        </div>

        {{- form_errors(form) -}}
    </div>
{%- endblock form_row -%}


{%- block choice_widget_expanded -%}
    <div id="checkbox_hierarchy_widget">
        {{ block('checkbox_hierarchy_widget') }}
        {#{%- for child in form %}#}
        {#{{ form.vars.choices|ladybug_dump }}#}
        {#{{- form_widget(child) -}}#}
        {#{{- form_label(child, null, {translation_domain: choice_translation_domain}) -}}#}
        {#{% endfor -%}#}
    </div>
{%- endblock choice_widget_expanded -%}


{% block checkbox_hierarchy_widget %}
    <ul class="listlessNEW spaced-listless" id="mainList">
        {% for choiceOrOptionGroup,children in form.vars.choices %}
            {% if children is iterable %}
                <ul>
                    {% for child,choiceView in children %}
                         {{ block('checkbox_hierarchy_widget2') }}
                    {% endfor %}
                </ul>
            {% else %}

                {# If not first loop, close previous <li> #}
                {% if not loop.first %}
                    </li>
                {% endif %}


                <li class="x">
                <label class="checkboxNEWx">
                    {{ form_widget(form.offsetGet(choiceOrOptionGroup)) }}
                    {{ form.offsetGet(choiceOrOptionGroup).vars.label }}
                </label>
            {% endif %}

            {# Last of the loop, there will be an open <li>, close it. #}
            {% if loop.last %}
                </li>
            {% endif %}
        {% endfor %}
    </ul>
{% endblock %}



{% block checkbox_hierarchy_widget2 %}
    {% if choiceView is iterable %}
        <ul>
            {% for child2,choiceView2 in choiceView %}
                {{ block('checkbox_hierarchy_widget3') }}

            {% endfor %}
        </ul>
    {% else %}

        {% if not loop.first %}
            </li>
        {% endif %}
        <li class="x">

        <label class="checkboxNEW margin-left-45 ">
            {{ form_widget(form.offsetGet(child)) }}
            {{ form.offsetGet(child).vars.label }}
        </label>
    {% endif %}

    {% if (choiceView|length -1) == loop.index %}
        </li>
    {% endif %}
{% endblock %}


{% block checkbox_hierarchy_widget3 %}
    {% if choiceView2 is iterable %}
    <ul>
        {% for child3, choiceView3 in choiceView2 %}
            <li>
                <label class="checkboxNEW margin-left-105">
                    {{ form_widget(form.offsetGet(child3)) }}
                    {{ form.offsetGet(child3).vars.label }}
                </label>
            </li>
        {% endfor %}
    </ul>
    {% else %}
        {% if not loop.first %}
            </li>
        {% endif %}

        <li class="x">
        <label class="checkboxNEW margin-left-95">
            {{ form_widget(form.offsetGet(child2)) }}
            {{ form.offsetGet(child2).vars.label }}
        </label>
    {% endif %}

    {% if (choiceView2|length -1) == loop.index %}
        </li>
    {% endif %}
{% endblock %}